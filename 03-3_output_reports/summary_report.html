<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Pollution &amp; Prejudice - Data Analysis Summary</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="summary_report_files/libs/clipboard/clipboard.min.js"></script>
<script src="summary_report_files/libs/quarto-html/quarto.js"></script>
<script src="summary_report_files/libs/quarto-html/popper.min.js"></script>
<script src="summary_report_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="summary_report_files/libs/quarto-html/anchor.min.js"></script>
<link href="summary_report_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="summary_report_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="summary_report_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="summary_report_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="summary_report_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="summary_report.md"><i class="bi bi-file-code"></i>Github (GFM)</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Pollution &amp; Prejudice - Data Analysis Summary</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- summary_report.md is generated from summary_report.qmd - edit that file -->
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>Placeholder text.</p>
<section id="intent-purpose" class="level3">
<h3 class="anchored" data-anchor-id="intent-purpose">Intent / Purpose</h3>
<ul>
<li><p>Analyze present-day pollution burden / vulnerability in neighborhoods that were assessed in the 1930s HOLC maps in California cities, and analyze trends by HOLC grade (to see if HOLC grade is a possible predictor of present day environmental conditions)</p></li>
<li><p>Assess present-day demographics of neighborhoods assessed in the 1930s HOLC maps in California cities, and assess whether the distribution of racial / ethnic groups differs by HOLC grade (to see if those areas are still segregated by HOLC grade today)</p></li>
</ul>
</section>
<section id="data-sources" class="level3">
<h3 class="anchored" data-anchor-id="data-sources">Data Sources</h3>
<ul>
<li>CalEnviroScreen (includes 2019 5-year ACS data)</li>
<li>HOLC (Redline) Maps</li>
</ul>
</section>
</section>
<section id="process-overview" class="level2">
<h2 class="anchored" data-anchor-id="process-overview">Process Overview</h2>
<p>Estimate CES scores and present-day racial / ethnic makeup for each neighborhood in the 1930s HOLC maps in California, using an area weighted average of CES scores / demographic data for census tracts that overlap each HOLC neighborhood</p>
<p><a href="#fig-map-process">Figure&nbsp;1</a> illustrates the process for estimating CES Scores.</p>
<ul>
<li>Panel 1 (left) shows the HOLC neighborhoods and their respective HOLC grades</li>
<li>Panel 2 shows the outline of the HOLC neighborhoods, overlaid on top of the CalEnviroScreen scores (by census tract)</li>
<li>Panel 3 shows the intersection of the HOLC neighborhoods and the CalEnviroScreen scores</li>
<li>Panel 4 (right) shows the estimated / computed CalEnviroScreen score for each HOLC neighborhood, based on an area weighted average of the CalEnviroScreen scores for the census tracts that overlap with each HOLC neighborhood</li>
</ul>
<div id="fig-map-process" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../03-2_output_plots/01_map-combined_Stockton.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Process Map</figcaption>
</figure>
</div>
</section>
<section id="results---calenviroscreen-scores" class="level2">
<h2 class="anchored" data-anchor-id="results---calenviroscreen-scores">Results - CalEnviroScreen Scores</h2>
<section id="raw-scores" class="level3">
<h3 class="anchored" data-anchor-id="raw-scores">Raw Scores</h3>
<p><a href="#fig-scores-raw">Figure&nbsp;2</a> shows the estimated CES score for each neighborhood in the 1930s HOLC maps.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-scores-raw" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="summary_report_files/figure-html/fig-scores-raw-1.png" class="img-fluid figure-img" width="3000"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Estimated CES scores for each neighborhood in the HOLC maps in California.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="average-scores-by-holc-grade" class="level3">
<h3 class="anchored" data-anchor-id="average-scores-by-holc-grade">Average Scores by HOLC Grade</h3>
<p><a href="#fig-scores-avg-by-grade">Figure&nbsp;3</a> shows the average of the estimated CES scores for each HOLC grade (A through D) within each city.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-scores-avg-by-grade" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="summary_report_files/figure-html/fig-scores-avg-by-grade-1.png" class="img-fluid figure-img" width="3000"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Average estimated CES scores for each HOLC grade within each city.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="adjusted-departure-scores" class="level3">
<h3 class="anchored" data-anchor-id="adjusted-departure-scores">Adjusted (Departure) Scores</h3>
<p><a href="#fig-scores-departure">Figure&nbsp;4</a> shows how we standardize the scores to allow for comparisons across cities.</p>
<ul>
<li>Calculate a “departure” score for each HOLC neighborhood, which is the difference between (1) the estimated CES score for that neighborhood and (2) the average of the estimated CES scores for all HOLC neighborhoods in that same city.</li>
<li>Essentially, this centers the average estimated CES score for all cities at zero, and makes comparisons across cities possible (otherwise, regional differences in the factors that CES measures would overwhelm any differences between HOLC grades)</li>
<li>A positive departure score means the CES score for that HOLC neighborhood is above the average for its city, whereas a negative score means the CES score is below the average for its city.</li>
</ul>
<div class="cell">
<div class="cell-output-display">
<div id="fig-scores-departure" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="summary_report_files/figure-html/fig-scores-departure-1.png" class="img-fluid figure-img" width="3000"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Estimated CES departure scores.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="adjusted-departure-scores---boxplot" class="level3">
<h3 class="anchored" data-anchor-id="adjusted-departure-scores---boxplot">Adjusted (Departure) Scores - Boxplot</h3>
<p><a href="#fig-boxplot">Figure&nbsp;5</a> shows a boxplot of the departure scores, which helps to illustrate the scale of the differences in estimated CES scores between the HOLC grades.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-boxplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="summary_report_files/figure-html/fig-boxplot-1.png" class="img-fluid figure-img" width="3000"></p>
<figcaption class="figure-caption">Figure&nbsp;5: Boxplot of estimated CES departure scores by HOLC grade.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="results---demographics" class="level2">
<h2 class="anchored" data-anchor-id="results---demographics">Results - Demographics</h2>
<p><a href="#fig-demographics-race">Figure&nbsp;6</a> shows the estimated present-day distribution of racial/ethnic groups across HOLC grades (for the population living within neighborhoods in California cities that were included in the 1930s HOLC maps).</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-demographics-race" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="summary_report_files/figure-html/fig-demographics-race-1.png" class="img-fluid figure-img" width="3000"></p>
<figcaption class="figure-caption">Figure&nbsp;6: Estimated present-day distribution of racial/ethnic groups across HOLC grades.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="comparison-of-alternative-methods-for-estimating-ces-scores" class="level2">
<h2 class="anchored" data-anchor-id="comparison-of-alternative-methods-for-estimating-ces-scores">Comparison of Alternative Methods for Estimating CES Scores</h2>
<p>To test the sensitivity of the estimated CES scores to the method used to compute the scores, we also estimated the overall CES score for each HOLC neighborhood using an alternative method - nearest centroid matching - and compared the results to those obtained from our original area weighted average method. This nearest centroid approach finds the CES census tract (excluding tracts without CES scores) whose centriod is closest to the centroid of each HOLC neighborhood, and assigns the CES score of the matched census tract to that HOLC neighborhood. If the results from the two methods are substantially the same, we can infer that the estimated CES scores are not highly sensitive to different calculation methods, and therefore have greater confidence in our estimated CES scores.</p>
<p><a href="#fig-score-method-comparison">Figure&nbsp;7</a> shows how the CES scores estimated for each HOLC neighborhood using the two methods compare across all HOLC grades.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-score-method-comparison" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="summary_report_files/figure-html/fig-score-method-comparison-1.png" style="width:5in;height:5in" class="figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;7: Comparison of CES scores computed with the area weighted average and nearest centroid methods.</figcaption>
</figure>
</div>
</div>
</div>
<p><a href="#fig-score-method-comparison-facet">Figure&nbsp;8</a> shows how the CES scores estimated for each HOLC neighborhood using the two methods compare for each of the four HOLC grades individually.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-score-method-comparison-facet" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="summary_report_files/figure-html/fig-score-method-comparison-facet-1.png" style="width:5in;height:5in" class="figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;8: Comparison of CES scores computed with the area weighted average and nearest centroid methods, by HOLC grade.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="summary-of-holc-neighborhoods-with-missing-ces-scores" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-holc-neighborhoods-with-missing-ces-scores">Summary of HOLC Neighborhoods with Missing CES Scores</h2>
<p>Some census tracts are not assigned a score for individual CES 4.0 indicators, or an overall CES 4.0 score. Of the 8035 total census tracts contained the in CES dataset, there are 103 tracts with missing overall CES scores, and varying numbers of tracts with missing scores for individual indicators - this includes 23 tracts with zero population.</p>
<p>Because some census tracts that are not assigned a CES score overlap with some HOLC neighborhoods, a minimum coverage threshold (as a percent of each HOLC neighborhood area covered by CES tracts with scores) is applied to determine which HOLC neighborhoods to assign CES scores to. A HOLC neighborhood is only assigned a CES score if the area covered by CES tracts with scores exceeds the minimum coverage threshold; otherwise, the HOLC neighborhood is assigned a NA (i.e., missing) value.</p>
<p>In our analysis, we use a minimum coverage threshold of 0.5. Using this threshold, there are 3 HOLC neighborhoods which fall below the threshold, and are not assigned a CES 4.0 score (i.e., they are given an <code>NA</code> value).</p>
<p><a href="#tbl-missing-scores">Table&nbsp;1</a> provides a summary of the number of HOLC neighborhoods with missing CES scores by CES measure and HOLC grade.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-missing-scores" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;1: Summary of missing HOLC neighborhoods which are not assigned CES scores.</caption>
<colgroup>
<col style="width: 52%">
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 9%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">ces_measure</th>
<th style="text-align: left;">holc_grade</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">n_total</th>
<th style="text-align: left;">pct_missing</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">calenviroscreen_4_0_score</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">273</td>
<td style="text-align: left;">0.37%</td>
</tr>
<tr class="even">
<td style="text-align: left;">calenviroscreen_4_0_score</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">331</td>
<td style="text-align: left;">0.60%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">drinking_water_score</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">273</td>
<td style="text-align: left;">0.37%</td>
</tr>
<tr class="even">
<td style="text-align: left;">education_score</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">273</td>
<td style="text-align: left;">0.37%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">education_score</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">331</td>
<td style="text-align: left;">0.30%</td>
</tr>
<tr class="even">
<td style="text-align: left;">housing_burden_score</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">273</td>
<td style="text-align: left;">0.37%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">housing_burden_score</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">331</td>
<td style="text-align: left;">0.60%</td>
</tr>
<tr class="even">
<td style="text-align: left;">lead_score</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">273</td>
<td style="text-align: left;">0.37%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lead_score</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">331</td>
<td style="text-align: left;">0.60%</td>
</tr>
<tr class="even">
<td style="text-align: left;">linguistic_isolation_score</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">273</td>
<td style="text-align: left;">1.83%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">linguistic_isolation_score</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">331</td>
<td style="text-align: left;">4.23%</td>
</tr>
<tr class="even">
<td style="text-align: left;">linguistic_isolation_score</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">155</td>
<td style="text-align: left;">0.65%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">low_birth_weight_score</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">273</td>
<td style="text-align: left;">0.37%</td>
</tr>
<tr class="even">
<td style="text-align: left;">low_birth_weight_score</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">331</td>
<td style="text-align: left;">0.91%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">population_characteristics_group_score</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">273</td>
<td style="text-align: left;">0.37%</td>
</tr>
<tr class="even">
<td style="text-align: left;">population_characteristics_group_score</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">331</td>
<td style="text-align: left;">0.60%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">population_characteristics_group_score_scaled</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">273</td>
<td style="text-align: left;">0.37%</td>
</tr>
<tr class="even">
<td style="text-align: left;">population_characteristics_group_score_scaled</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">331</td>
<td style="text-align: left;">0.60%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">poverty_score</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">273</td>
<td style="text-align: left;">0.37%</td>
</tr>
<tr class="even">
<td style="text-align: left;">poverty_score</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">331</td>
<td style="text-align: left;">0.30%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">traffic_score</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">273</td>
<td style="text-align: left;">0.37%</td>
</tr>
<tr class="even">
<td style="text-align: left;">unemployment_score</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">109</td>
<td style="text-align: left;">2.75%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">unemployment_score</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">273</td>
<td style="text-align: left;">2.93%</td>
</tr>
<tr class="even">
<td style="text-align: left;">unemployment_score</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">331</td>
<td style="text-align: left;">2.11%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">unemployment_score</td>
<td style="text-align: left;">D</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">155</td>
<td style="text-align: left;">0.65%</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>